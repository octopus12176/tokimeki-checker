<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ときめきチェッカー💫</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800;900&family=Zen+Maru+Gothic:wght@400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <div class="floaties" id="floaties"></div>

    <!-- ── Header ── -->
    <header class="header">
      <div class="logo">
        <span class="logo-badge">✨</span>ときめきチェッカー
      </div>
      <div class="header-right" id="header-right" style="display:none">
        <div class="user-info">
          <img
            id="user-picture"
            class="user-avatar"
            src=""
            alt=""
            style="display: none"
          />
          <span id="user-name"></span>
        </div>
        <button class="pill-btn mint" onclick="App.showSavings()">
          💰 節約
        </button>
        <button class="pill-btn yellow" onclick="App.openHistory()">
          📋 履歴
        </button>
        <button class="pill-btn light" onclick="App.handleLogout()">
          ログアウト
        </button>
      </div>
    </header>

    <div id="app">
      <!-- ══ Screen: Login ══ -->
      <div class="screen" id="screen-login">
        <div class="card">
          <div class="login-logo">✨</div>
          <div class="login-title">ときめきチェッカー</div>
          <p class="login-sub">
            欲しいものを6つの視点でチェック。<br />
            ときめき・必要性・見栄・代替手段・消費の本質まで。
          </p>
          <div class="login-features">
            <div class="login-feature">
              <span class="login-feature-icon">🔍</span
              >購買衝動を6つの視点で分析
            </div>
            <div class="login-feature">
              <span class="login-feature-icon">🤖</span
              >AIが各回答にフィードバック
            </div>
            <div class="login-feature">
              <span class="login-feature-icon">💰</span>節約額を記録・累計表示
            </div>
            <div class="login-feature">
              <span class="login-feature-icon">📋</span>チェック履歴をDBに保存
            </div>
          </div>
          <button class="btn-google" onclick="App.handleLogin()">
            <svg width="20" height="20" viewBox="0 0 48 48">
              <path
                fill="#EA4335"
                d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"
              />
              <path
                fill="#4285F4"
                d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"
              />
              <path
                fill="#FBBC05"
                d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"
              />
              <path
                fill="#34A853"
                d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.18 1.48-4.97 2.31-8.16 2.31-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"
              />
            </svg>
            Googleでログイン
          </button>
        </div>
      </div>

      <!-- ══ Screen: Input ══ -->
      <div class="screen" id="screen-input">
        <div class="card">
          <div class="screen-title">
            欲しいもの、<br /><span class="hl">本音で</span>チェック！🔍
          </div>
          <p class="screen-subtitle">
            6つの視点からあなたの購買衝動を分析します。<br />
            ときめき・必要性・代替手段・社会の目線まで。
          </p>
          <div class="field-label"><span class="dot"></span>欲しいもの</div>
          <input
            type="text"
            id="item-name"
            placeholder="例：ワイヤレスイヤホン 🎧"
            maxlength="40"
          />
          <div class="field-label">
            <span class="dot" style="background: var(--mint)"></span
            >お値段（節約額の記録に使います）
          </div>
          <div class="price-row">
            <span class="yen-badge">¥</span>
            <input type="number" id="item-price" placeholder="0" min="0" />
          </div>
          <button class="btn-primary pink" onclick="App.startCheck()">
            チェックスタート！ 🚀
          </button>
        </div>
      </div>

      <!-- ══ Screen: Questions ══ -->
      <div class="screen" id="screen-questions">
        <div class="card" id="q-card">
          <div class="progress-wrap">
            <div class="progress-meta">
              <span class="progress-label" id="q-number-label"></span>
              <div class="progress-steps" id="step-dots"></div>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="progress-fill"></div>
            </div>
          </div>
          <div class="q-item-chip" id="q-chip">
            🛍️ <span id="q-chip-name"></span>
          </div>
          <div class="q-theme-tag" id="q-theme-tag"></div>
          <div class="q-text" id="q-text"></div>
          <div class="q-sub" id="q-sub"></div>
          <div class="q-options" id="q-options"></div>
          <div
            class="feedback-bubble"
            id="feedback-bubble"
            style="display: none"
          >
            <span class="fb-icon">🤖</span>
            <span class="fb-text" id="fb-text"></span>
          </div>
          <button
            class="btn-next"
            id="btn-next"
            onclick="App.nextQuestion()"
            disabled
            style="display: none"
          >
            次の質問へ →
          </button>
        </div>
      </div>

      <!-- ══ Screen: Loading ══ -->
      <div class="screen" id="screen-loading">
        <div class="card loading-card">
          <div class="loading-blob">🔮</div>
          <div class="loading-text">最終判定を生成中…！</div>
          <div class="loading-sub">AIが6つの視点から総合的に分析しています</div>
          <div class="loading-dots">
            <span></span><span></span><span></span>
          </div>
        </div>
      </div>

      <!-- ══ Screen: Result ══ -->
      <div class="screen" id="screen-result">
        <div class="card">
          <!-- Verdict -->
          <div class="result-header">
            <div class="result-emoji-wrap">
              <div class="result-circle" id="result-circle"></div>
              <div class="confetti-bits" id="confetti-container"></div>
            </div>
            <div class="result-score-badge" id="result-score"></div>
            <div class="result-verdict" id="result-verdict"></div>
            <p class="result-desc" id="result-desc"></p>
          </div>

          <!-- Did you buy it? -->
          <div class="decision-section" id="decision-section">
            <div class="decision-title">💬 実際にどうしましたか？</div>
            <div class="decision-sub">記録しておくと節約額が積み上がります</div>
            <div class="decision-btns">
              <button
                class="decision-btn bought"
                onclick="App.recordDecision(true)"
              >
                🛒 買った
              </button>
              <button
                class="decision-btn skipped"
                onclick="App.recordDecision(false)"
              >
                🌿 買わなかった
              </button>
            </div>
          </div>

          <!-- Savings confirmed block (shown after recording skip) -->
          <div
            class="savings-result-block"
            id="savings-result-block"
            style="display: none"
          >
            <div class="savings-result-label">今回の節約額 💰</div>
            <div class="savings-result-num" id="savings-result-amount">¥0</div>
            <div class="savings-total-label">
              累計節約額：<span
                class="savings-total-num"
                id="savings-total-inline"
                >¥0</span
              >
            </div>
          </div>

          <!-- Timeline -->
          <div class="timeline-title">📝 6つの視点からのフィードバック</div>
          <div class="timeline" id="timeline"></div>

          <button class="btn-primary pink" onclick="App.resetApp()">
            🔁 もう一度チェックする
          </button>
        </div>
      </div>

      <!-- ══ Screen: Savings ══ -->
      <div class="screen" id="screen-savings">
        <div class="card">
          <div class="savings-hero">
            <div class="savings-hero-label">あなたの累計節約額 🌿</div>
            <div class="savings-hero-amount" id="savings-amount">¥0</div>
            <div class="savings-hero-sub">
              チェックで「買わなかった」を選んだ合計
            </div>
          </div>
          <div class="savings-list-title">節約の記録</div>
          <div id="savings-list"></div>
          <button
            class="btn-primary yellow"
            style="margin-top: 24px"
            onclick="UI.showScreen('screen-input')"
          >
            ← もどる
          </button>
        </div>
      </div>
    </div>
    <!-- /#app -->

    <!-- ── History Modal ── -->
    <div
      class="modal-overlay"
      id="modal-overlay"
      onclick="App.handleOverlayClick(event)"
    >
      <div class="modal">
        <div class="modal-handle"></div>
        <div class="modal-title">📋 チェック履歴</div>
        <div id="history-list"></div>
        <button class="modal-close-btn" onclick="App.closeHistory()">
          閉じる
        </button>
      </div>
    </div>

    <!-- ── Toast ── -->
    <div class="toast" id="toast"></div>

    <script src="/js/questions.js"></script>
    <script src="/js/ui.js"></script>
    <script src="/js/app.js"></script>
  </body>
</html>
